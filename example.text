from openai import OpenAI
import os
from textwrap import dedent

client = OpenAI(api_key=os.getenv("OPENAI_API_KEY"))

# 1. Upload the PDF
file = client.files.create(
    file=open("document.pdf", "rb"),
    purpose="user_data"  # Note: Azure may not currently support user_data for PDFsâ€”check limitations.:contentReference[oaicite:2]{index=2}
)

# 2. Define the JSON schema you expect
json_schema = {
    "name": "DocumentSummary",
    "schema": {
        "type": "object",
        "properties": {
            "title": {"type": "string"},
            "date": {"type": "string"},
            "key_points": {
                "type": "array",
                "items": {"type": "string"}
            }
        },
        "required": ["title", "key_points"],
        "additionalProperties": False
    },
    "strict": True
}

# 3. Send Responses API request with structured output enforced
response = client.responses.create(
    model="gpt-4o-2024-08-06",  # or "gpt-4.1"
    input=[
        {
            "role": "user",
            "content": [
                {"type": "input_file", "file_id": file.id},
                {"type": "input_text", "text": "Extract the following information from the PDF: title, date (if any), and key points as bullet points."}
            ]
        }
    ],
    response_format={
        "type": "json_schema",
        "json_schema": json_schema
    }
)

# 4. Retrieve and use the structured JSON
structured = response.choices[0].message.content
print(structured)
